import"../chunks/NZTpNUN0.js";import"../chunks/Vvm9udaT.js";import{o as ge,a as be}from"../chunks/BB32ouRY.js";import{X as he,au as z,av as $e,_ as ke,w as t,L as m,W as xe,ay as we,a0 as v,a3 as i,a2 as o,x as y,aw as d,ax as Ie,l as Y}from"../chunks/DJxVeldX.js";import{s as p,e as E}from"../chunks/C9woGF-z.js";import{i as ze}from"../chunks/292SS5JT.js";import{e as ye}from"../chunks/DHri6rd4.js";import{b as R,a as A}from"../chunks/fOQuHGXh.js";import{s as De}from"../chunks/CVCkp_ml.js";import{b as Pe}from"../chunks/B1Ur4i1a.js";import{i as Te}from"../chunks/Degfot_7.js";import{s as Ce,a as Z}from"../chunks/ZTUH0_7J.js";import{g as u}from"../chunks/knpjl46v.js";import{$ as Ee}from"../chunks/Bit4kGOU.js";import{I as F}from"../chunks/Cphc7EI3.js";import{P as M}from"../chunks/BRDq7uV6.js";import{l as Ae,a as Fe}from"../chunks/CKOQZQXO.js";import{a as Me}from"../chunks/BXQQiVcS.js";import"../chunks/gt9WcTCj.js";import{A as Re}from"../chunks/CNDu6GJm.js";var je=R('<p class="first-scene svelte-1b31mzo"> </p>'),qe=R('<section class="reel svelte-1b31mzo"><!> <div class="overlay svelte-1b31mzo"><div class="info-box svelte-1b31mzo"><div class="creator-line svelte-1b31mzo"><span class="creator-name svelte-1b31mzo"> </span></div> <div class="name-line svelte-1b31mzo"><strong class="name svelte-1b31mzo"> </strong></div> <!> <div class="tags-line svelte-1b31mzo"></div></div> <div class="action-sidebar svelte-1b31mzo"><button class="action-button svelte-1b31mzo"><!> <span class="action-label svelte-1b31mzo"> </span></button> <button class="action-button svelte-1b31mzo"><!> <span class="action-label svelte-1b31mzo"> </span></button>  <button class="action-button svelte-1b31mzo"><!> <span class="action-label svelte-1b31mzo"> </span></button></div></div></section>'),Be=R('<div class="feed-container svelte-1b31mzo"></div>');function ia(ee,ae){he(ae,!1);const[j,te]=Ce(),q=()=>Z(D,"$contents",j),$=()=>Z(Ee,"$t",j),se=m(),B=m(),L=m(),O=m();let re=[],ie=[],D=xe([]),c=m(new Map),U,_=null,k,x=m();ge(async()=>{const e=await Ae(),a=await Fe();for(const s of e)s.image_metadatas&&s.image_metadatas.length>0&&(s.image_metadatas.unshift({url:`${M}${s.owner_id[0]}/${s.id}.portrait`,description:"portrait",type:"image"}),t(c).set(s.id,0)),a&&a.forEach(r=>{r===s.id&&(s.is_liked=!0)});D.set(e),await we();const l={root:t(x),threshold:.8};k=new IntersectionObserver(s=>{s.forEach(r=>{r.isIntersecting?(r.target.classList.add("active"),_=r.target.id):r.target.classList.remove("active")})},l),t(x).querySelectorAll(".reel").forEach(s=>k.observe(s)),U=setInterval(()=>{if(!_)return;const s=q().find(r=>r.id===_);if(s&&s.image_metadatas&&s.image_metadatas.length>1){const r=new Map(t(c)),g=((r.get(_)||0)+1)%s.image_metadatas.length;r.set(_,g),v(c,r)}},5e3)}),be(()=>{clearInterval(U),k&&k.disconnect()});function N(e){switch(e.personaType){case"live":u("/live");break;case"3D":t(O)(e.id)?u(`/auction?c=${e.id}`):t(L)(e.id)?u(`/live?c=${e.id}`):u(`/character?c=${e.id}`);break;case"2D":u(`/2d?c=${e.id}`);break;case"text":u("/chat");break}}async function oe(e,a){const f=`/api/persona/like?id=${e.id}`;try{const s=await Me.get(f);if(s.ok)D.update(r=>r.map(n=>n.id===e.id?{...n,is_liked:a,likes_count:a?n.likes_count+1:n.likes_count-1}:n));else if(s.status===409){const r=await s.json();alert($()("feed.alreadyFeedback",{values:{action:a?"좋아요":"싫어요"}}))}else{const r=await s.json();alert($()("feed.feedbackFailed",{values:{action:a?"좋아요":"싫어요",message:r.message||s.statusText}}))}}catch(s){console.error("Network or other error:",s),alert($()("feed.unexpectedError"))}}z(()=>t(c),()=>{v(se,e=>{let a=`${M}${e.owner_id[0]}/${e.id}.portrait`;if(e.image_metadatas&&e.image_metadatas.length>0){const l=t(c).get(e.id)||0;e.image_metadatas[l]?.url&&(a=e.image_metadatas[l].url)}return`url(${a})`})}),z(()=>t(c),()=>{v(B,e=>{let a={url:`${M}${e.owner_id[0]}/${e.id}.portrait`,description:"portrait",type:"image"};if(e.image_metadatas&&e.image_metadatas.length>0){const l=t(c).get(e.id)||0;e.image_metadatas[l]&&(a=e.image_metadatas[l])}return a})}),z(()=>{},()=>{v(L,e=>re.includes(e))}),z(()=>{},()=>{v(O,e=>ie.some(a=>a.personaId===e))}),$e(),Te();var w=Be();ye(w,5,q,e=>e.id,(e,a)=>{var l=qe(),f=o(l);const s=y(()=>t(B)(t(a)));Re(f,{get asset(){return t(s)}});var r=d(f,2),n=o(r),g=o(n),S=o(g),le=o(S);i(S),i(g);var P=d(g,2),W=o(P),ne=o(W,!0);i(W),i(P);var de=d(P,2);{var ce=h=>{var C=je(),_e=o(C);i(C),Y(fe=>p(_e,`"${fe??""}${t(a).greeting.length>80?"...":""}"`),[()=>t(a).greeting.slice(0,80)],y),A(h,C)};ze(de,h=>{t(a).greeting&&h(ce)})}Ie(2),i(n);var X=d(n,2),I=o(X),G=o(I);F(G,{icon:"ph:chat-circle-dots-duotone",width:"32",height:"32"});var H=d(G,2),me=o(H,!0);i(H),i(I);var b=d(I,2),J=o(b);const ve=y(()=>t(a).is_liked?"ph:heart-fill":"ph:heart-duotone");F(J,{get icon(){return t(ve)},width:"32",height:"32"});var K=d(J,2),pe=o(K,!0);i(K),i(b);var T=d(b,2),Q=o(T);F(Q,{icon:"ph:eye-duotone",width:"32",height:"32"});var V=d(Q,2),ue=o(V,!0);i(V),i(T),i(X),i(r),i(l),Y(h=>{De(l,"id",t(a).id),p(le,`@${t(a).creator_name??""}`),p(ne,t(a).name),p(me,h),b.disabled=t(a).is_liked,p(pe,t(a).likes_count),p(ue,t(a).chat_count)},[()=>$()("feed.interact")],y),E("click",I,()=>N(t(a))),E("click",b,()=>oe(t(a),!0)),E("click",T,()=>N(t(a))),A(e,l)}),i(w),Pe(w,e=>v(x,e),()=>t(x)),A(ee,w),ke(),te()}export{ia as component};
