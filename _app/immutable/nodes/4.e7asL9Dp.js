import{d as L,b as y,t as ft}from"../chunks/kz80bbCR.js";import{i as ht}from"../chunks/2r1cYJse.js";import{c as Pt,o as Tt,a as kt}from"../chunks/D0mpzbhj.js";import{w as _t,W as x,al as a,am as r,ap as n,Q as t,aj as I,O as E,V as u,z as bt,aq as Ct,ar as Et,as as mt,aD as gt}from"../chunks/BUDlkbfV.js";import{s as l}from"../chunks/BbnaKca8.js";import{i as A}from"../chunks/28pso2Hb.js";import{e as G}from"../chunks/CiCNsvIE.js";import{b as Dt}from"../chunks/CAWQASXy.js";import{b as St}from"../chunks/CGc6l0L7.js";import{a as vt,s as wt}from"../chunks/D32zTIdM.js";import{p as Ut}from"../chunks/dMfnY97A.js";import{l as Ht}from"../chunks/Caezn3U5.js";import{p as qt,f as At}from"../chunks/DGRjBuv2.js";import{B as Lt,a as jt,c as Ot,s as Vt}from"../chunks/DB9-tYX_.js";import"../chunks/pfmv5nwf.js";import"../chunks/vNtm5tQc.js";import"../chunks/C-VEydUt.js";import{w as Wt}from"../chunks/e6l8DgL1.js";import"../chunks/-4D0oWvs.js";import"../chunks/DqiWXVxP.js";import{r as Ft,s as lt}from"../chunks/BJyhluUY.js";import{t as Kt,a as Qt}from"../chunks/B2SxtloT.js";import{b as Rt}from"../chunks/njKOc8Q7.js";import{a as Gt}from"../chunks/BqlTOgs2.js";import{p as ct}from"../chunks/Bf5_DoVm.js";import{q as Jt}from"../chunks/Ccw7PXcW.js";import{$ as $t}from"../chunks/C36u96xB.js";var Nt=L('<p class="error-message svelte-1pfiozz"> </p>'),Xt=L('<div class="modal-backdrop svelte-1pfiozz" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-content svelte-1pfiozz"><h2 class="svelte-1pfiozz"> </h2> <div class="bid-info svelte-1pfiozz"><p class="svelte-1pfiozz"><strong> </strong> </p> <p class="svelte-1pfiozz"><strong> </strong> </p></div> <div class="input-group svelte-1pfiozz"><label for="bid-amount" class="svelte-1pfiozz"> </label> <input id="bid-amount" type="number" class="svelte-1pfiozz"/></div> <!> <div class="button-group svelte-1pfiozz"><button class="submit-button svelte-1pfiozz"><!></button> <button class="cancel-button svelte-1pfiozz"> </button></div></div></div>');function Yt(et,P){_t(P,!1);const[J,at]=wt(),p=()=>vt($t,"$t",J);let v=ct(P,"personaId",8),w=ct(P,"currentHighestBid",8,0),h=ct(P,"minBidIncrement",8,10);const $=Pt();let d=x(w()+h()),z=x(""),_=x(!1);function j(){$("close")}async function O(){if(t(d)<=w()){u(z,p()("bidModal.bidTooLow",{values:{currentHighestBid:w()}}));return}if(t(d)%h()!==0){u(z,p()("bidModal.bidIncrementError",{values:{minBidIncrement:h()}}));return}u(_,!0),u(z,"");try{await qt(v(),t(d)),$("close")}catch(i){u(z,i.message||p()("bidModal.bidError"))}finally{u(_,!1)}}function b(i){i.key==="Escape"&&j()}ht();var T=Xt(),D=a(T),S=a(D),V=a(S,!0);r(S);var U=n(S,2),H=a(U),k=a(H),N=a(k);r(k);var rt=n(k);r(H);var W=n(H,2),F=a(W),q=a(F);r(F);var st=n(F);r(W),r(U);var K=n(U,2),Q=a(K),X=a(Q);r(Q);var B=n(Q,2);Ft(B),r(K);var Y=n(K,2);{var it=i=>{var c=Nt(),f=a(c,!0);r(c),I(()=>l(f,t(z))),y(i,c)};A(Y,i=>{t(z)&&i(it)})}var Z=n(Y,2),C=a(Z),e=a(C);{var s=i=>{var c=ft();I(f=>l(c,f),[()=>p()("bidModal.biddingInProgress")],E),y(i,c)},o=i=>{var c=ft();I(f=>l(c,f),[()=>p()("bidModal.placeBid")],E),y(i,c)};A(e,i=>{t(_)?i(s):i(o,!1)})}r(C);var m=n(C,2),M=a(m,!0);r(m),r(Z),r(D),r(T),I((i,c,f,g,R,ot,tt,nt)=>{l(V,i),l(N,`${c??""}:`),l(rt,` ${w()??""} ${f??""}`),l(q,`${g??""}:`),l(st,` ${h()??""} ${R??""}`),l(X,`${ot??""}:`),lt(B,"min",w()+h()),lt(B,"step",h()),lt(B,"placeholder",tt),B.disabled=t(_),C.disabled=t(_),m.disabled=t(_),l(M,nt)},[()=>p()("bidModal.title"),()=>p()("bidModal.currentHighestBid"),()=>p()("bidModal.credits"),()=>p()("bidModal.minBidIncrement"),()=>p()("bidModal.credits"),()=>p()("bidModal.bidCredits"),()=>`${w()+h()} ${p()("bidModal.minBidPlaceholder")}`,()=>p()("bidModal.cancel")],E),Rt(B,()=>t(d),i=>u(d,i)),G("click",C,O),G("click",m,j),Kt(3,D,()=>Qt,()=>({y:-50,duration:300,easing:Jt})),G("click",T,Gt(j)),G("keydown",T,b),y(et,T),bt(),at()}var Zt=L('<h2 class="persona-name svelte-1t5hwdi"> </h2> <p class="user-credits svelte-1t5hwdi"> <strong></strong></p>',1),te=L('<div class="status-box svelte-1t5hwdi"><p class="svelte-1t5hwdi"><strong class="svelte-1t5hwdi"> </strong> <span class="highlight-bid svelte-1t5hwdi"> </span> </p> <p class="svelte-1t5hwdi"><strong class="svelte-1t5hwdi"> </strong> <span class="highlight-time svelte-1t5hwdi"> </span></p> <p class="svelte-1t5hwdi"><strong class="svelte-1t5hwdi"> </strong> <span class="highlight-winner svelte-1t5hwdi"> </span></p></div>'),ee=L('<p class="error-message svelte-1t5hwdi"> </p>'),ae=L('<div class="auction-live-layout svelte-1t5hwdi"><canvas class="vrm-canvas svelte-1t5hwdi"></canvas> <div class="info-sidebar svelte-1t5hwdi"><div class="auction-info svelte-1t5hwdi"><!> <!> <button class="bid-button svelte-1t5hwdi"> </button> <!></div> <div class="chat-area svelte-1t5hwdi"><!> <!></div></div></div> <!>',1);function ke(et,P){_t(P,!1);const[J,at]=wt(),p=()=>vt(Ut,"$page",J),v=()=>vt($t,"$t",J);let w=x(!1),h=x(""),$=x(null),d=x(null),z=x();const _=Wt([]);Tt(async()=>{const e=p().url.searchParams.get("c");if(e){u($,await Ht(e));try{u(d,await At(e))}catch(s){console.error("fetchAuctionStatus :",s)}Ot(t($)?.id||"fuck",s=>{if(s.type==="bid"){let o=s.bid;if(!t(d))return;gt(d,t(d).highestBid=o.amount),gt(d,t(d).winner=o.userId)}else s.type==="chat"&&_.update(o=>[...o,{user:v()("auctionPage.bidder"),msg:s.msg}])});try{t($)}catch(s){console.error("Error loading VRM:",s)}}});function j(e){Vt(e)}let O=x(v()("auctionPage.calculatingTime")),b=x();function T(e){if(e<=0)return v()("auctionPage.auctionEnded");const s=Math.floor(e/1e3),o=Math.floor(s/60),m=Math.floor(o/60),M=Math.floor(m/24),i=s%60,c=o%60,f=m%24;let g=[];return M>0&&g.push(`${M}${v()("auctionPage.dayUnit")}`),f>0&&g.push(`${f}${v()("auctionPage.hourUnit")}`),c>0&&g.push(`${c}${v()("auctionPage.minuteUnit")}`),(i>0||g.length===0)&&g.push(`${i}${v()("auctionPage.secondUnit")}`),g.length===0&&e>0?`0${v()("auctionPage.secondUnit")}`:g.join(" ")}function D(){if(!t(d)||!t(d).endAt){u(O,v()("auctionPage.noTimeInfo")),t(b)&&clearInterval(t(b));return}const e=new Date(t(d).endAt).getTime(),s=Date.now(),o=e-s;u(O,T(o)),o<=0&&clearInterval(t(b))}kt(()=>{t(b)&&clearInterval(t(b))}),Ct(()=>(t(d),t(b)),()=>{t(d)&&(t(b)&&clearInterval(t(b)),D(),u(b,setInterval(D,1e3)))}),Et(),ht();var S=ae(),V=mt(S),U=a(V);St(U,e=>u(z,e),()=>t(z));var H=n(U,2),k=a(H),N=a(k);{var rt=e=>{var s=Zt(),o=mt(s),m=a(o,!0);r(o);var M=n(o,2),i=a(M),c=n(i);c.textContent="255",r(M),I(f=>{l(m,t($).name),l(i,`${f??""}: `)},[()=>v()("auctionPage.myCredits")],E),y(e,s)};A(N,e=>{t($)&&e(rt)})}var W=n(N,2);{var F=e=>{var s=te(),o=a(s),m=a(o),M=a(m);r(m);var i=n(m,2),c=a(i,!0);r(i);var f=n(i);r(o);var g=n(o,2),R=a(g),ot=a(R);r(R);var tt=n(R,2),nt=a(tt,!0);r(tt),r(g);var ut=n(g,2),dt=a(ut),xt=a(dt);r(dt);var pt=n(dt,2),zt=a(pt,!0);r(pt),r(ut),r(s),I((Bt,Mt,yt,It)=>{l(M,`${Bt??""}:`),l(c,t(d).highestBid),l(f,` ${Mt??""}`),l(ot,`${yt??""}:`),l(nt,t(O)),l(xt,`${It??""}:`),l(zt,t(d).winner)},[()=>v()("auctionPage.highestBid"),()=>v()("auctionPage.creditsUnit"),()=>v()("auctionPage.remainingTime"),()=>v()("auctionPage.currentLeader")],E),y(e,s)};A(W,e=>{t(d)&&e(F)})}var q=n(W,2),st=a(q,!0);r(q);var K=n(q,2);{var Q=e=>{var s=ee(),o=a(s,!0);r(s),I(()=>l(o,t(h))),y(e,s)};A(K,e=>{t(h)&&e(Q)})}r(k);var X=n(k,2),B=a(X);Lt(B,{get messages(){return _}});var Y=n(B,2);jt(Y,{onSend:j}),r(X),r(H),r(V);var it=n(V,2);{var Z=e=>{const s=E(()=>t(d)?.highestBid||0);Yt(e,{get personaId(){return t($).id},get currentHighestBid(){return t(s)},minBidIncrement:10,$$events:{close:()=>u(w,!1),error:o=>u(h,o.detail)}})};A(it,e=>{t(w)&&t($)&&e(Z)})}I(e=>l(st,e),[()=>v()("auctionPage.placeBidButton")],E),G("click",q,()=>u(w,!0)),y(et,S),Dt(P,"broadcastMessages",_);var C=bt({broadcastMessages:_});return at(),C}export{ke as component};
