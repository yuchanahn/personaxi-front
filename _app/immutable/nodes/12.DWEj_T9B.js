import{d as _,b as g,e as Te}from"../chunks/kz80bbCR.js";import{i as le}from"../chunks/2r1cYJse.js";import{c as De,a as $e,o as Pe}from"../chunks/D0mpzbhj.js";import{w as de,aq as K,V as l,W as b,ao as ne,ar as ce,al as r,Q as a,an as N,am as o,ap as v,aj as U,z as ge,as as qe,aE as Ee,O as Me}from"../chunks/BUDlkbfV.js";import{i as k}from"../chunks/28pso2Hb.js";import{e as Fe}from"../chunks/BOGOvxWJ.js";import{s as Le}from"../chunks/BJyhluUY.js";import{b as Ne}from"../chunks/CGc6l0L7.js";import{a as Oe}from"../chunks/JtpDz4mb.js";import{s as T}from"../chunks/BbnaKca8.js";import{k as Ve}from"../chunks/B5DqLm-d.js";import{e as O}from"../chunks/CiCNsvIE.js";import{p as ve}from"../chunks/Bf5_DoVm.js";import{I}from"../chunks/DaDtKPX8.js";import{g as q}from"../chunks/DqiWXVxP.js";import{A as ze}from"../chunks/DxUrSklm.js";import{L as Qe}from"../chunks/Dr8j7HxN.js";var Re=_('<div class="fade-in svelte-bggjoi"><!></div>'),Se=_('<div class="badge vrm svelte-bggjoi"><!> VRM</div>'),We=_('<div class="badge live2d svelte-bggjoi"><!> Live2D</div>'),Be=_('<span class="cursor svelte-bggjoi">|</span>'),Ge=_('<p class="greeting-fallback svelte-bggjoi"> </p>'),He=_('<div class="feed-item svelte-bggjoi"><div class="image-layer svelte-bggjoi"><!> <div class="gradient-overlay svelte-bggjoi"></div></div> <div class="info-layer svelte-bggjoi"><div class="header svelte-bggjoi"><div class="creator-badge svelte-bggjoi"><!> <span class="svelte-bggjoi"> </span></div> <div class="badges svelte-bggjoi"><!> <!></div></div> <div class="content-area svelte-bggjoi"><h2 class="name svelte-bggjoi"> </h2> <div class="one-liner-container svelte-bggjoi"><p class="one-liner svelte-bggjoi"> <!></p> <!></div> <div class="stats-row svelte-bggjoi"><div class="stat svelte-bggjoi"><!> </div> <div class="stat svelte-bggjoi"><!> </div></div></div> <div class="actions-area svelte-bggjoi"><button class="action-btn chat-btn svelte-bggjoi"><!> <span class="svelte-bggjoi">Chat</span></button> <button class="action-btn info-btn svelte-bggjoi"><!></button></div></div></div>');function Je(V,D){de(D,!1);let e=ve(D,"persona",8),m=ve(D,"isActive",8,!1);const E=De();let f=b(0),u=b([]),p;function M(){y(),a(u).length>1&&(p=setInterval(()=>{l(f,(a(f)+1)%a(u).length)},5e3))}function y(){p&&clearInterval(p)}let h=b(""),$,j=b(!1);function F(){if(!e().one_liner){l(h,e().greeting||"");return}l(h,""),l(j,!1);let t=0;const s=e().one_liner;w(),$=setInterval(()=>{t<s.length?(l(h,a(h)+s.charAt(t)),t++):(w(),l(j,!0))},50)}function w(){$&&clearInterval($)}$e(()=>{y(),w()});function z(t){t.stopPropagation(),e().owner_id&&e().owner_id.length>0&&q(`/creator?c=${e().owner_id[0]}`)}function Q(t){t.stopPropagation(),e().personaType==="3D"?q(`/character?c=${e().id}`):e().personaType==="2D"?q(`/2d?c=${e().id}`):q(`/live2d?c=${e().id}`)}K(()=>ne(e()),()=>{let t=[];t.push({url:e().portrait_url,description:"portrait"}),e().image_metadatas&&(t=[...t,...e().image_metadatas]),l(u,t)}),K(()=>ne(m()),()=>{m()?(M(),F()):(y(),w(),l(f,0))}),ce(),le();var A=He(),i=r(A),n=r(i);{var c=t=>{var s=Te(),x=qe(s);Ve(x,()=>a(f),Ae=>{var J=Re(),Ce=r(J);ze(Ce,{get asset(){return a(u)[a(f)]}}),o(J),g(Ae,J)}),g(t,s)};k(n,t=>{a(u).length>0&&t(c)})}N(2),o(i);var d=v(i,2),P=r(d),C=r(P),X=r(C);I(X,{icon:"ph:user-circle-duotone"});var Y=v(X,2),fe=r(Y,!0);o(Y),o(C);var Z=v(C,2),ee=r(Z);{var pe=t=>{var s=Se(),x=r(s);I(x,{icon:"ph:cube-transparent-duotone"}),N(),o(s),g(t,s)};k(ee,t=>{(e().personaType==="3D"||e().tags?.includes("1001"))&&t(pe)})}var _e=v(ee,2);{var me=t=>{var s=We(),x=r(s);I(x,{icon:"ph:star-four-duotone"}),N(),o(s),g(t,s)};k(_e,t=>{e().personaType==="2D"&&e().live2d_model_url&&t(me)})}o(Z),o(P);var R=v(P,2),S=r(R),ue=r(S,!0);o(S);var W=v(S,2),B=r(W),te=r(B),be=v(te);{var he=t=>{var s=Be();g(t,s)};k(be,t=>{m()&&!a(j)&&e().one_liner&&t(he)})}o(B);var je=v(B,2);{var ye=t=>{var s=Ge(),x=r(s,!0);o(s),U(()=>T(x,e().greeting)),g(t,s)};k(je,t=>{e().one_liner||t(ye)})}o(W);var ae=v(W,2),G=r(ae),ie=r(G);I(ie,{icon:"mdi:heart"});var we=v(ie);o(G);var re=v(G,2),oe=r(re);I(oe,{icon:"mdi:chat"});var xe=v(oe);o(re),o(ae),o(R);var se=v(R,2),L=r(se),Ie=r(L);I(Ie,{icon:"ph:chat-circle-text-fill",width:"24"}),N(2),o(L);var H=v(L,2),ke=r(H);I(ke,{icon:"ph:info",width:"24"}),o(H),o(se),o(d),o(A),U(()=>{T(fe,e().creator_name),T(ue,e().name),T(te,`${a(h)??""} `),T(we,` ${e().likes_count??""}`),T(xe,` ${e().chat_count??""}`)}),O("click",C,z),O("click",L,Q),O("click",H,()=>q(`/profile?c=${e().id}`)),O("click",A,()=>E("click")),g(V,A),ge()}var Ke=_('<div class="feed-item-wrapper svelte-1o81g4a"><!></div>'),Ue=_('<div class="loading-indicator svelte-1o81g4a"><!></div>'),Xe=_('<div class="empty-state svelte-1o81g4a"><p>No personas found.</p></div>'),Ye=_('<div class="feed-page svelte-1o81g4a"><!> <!> <!></div>');function mt(V,D){de(D,!1);let e=b([]),m=b(!1),E=0;const f=10;let u=!0,p=b(),M=b(0),y=b();async function h(){if(!(a(m)||!u)){l(m,!0);try{const i=await Oe(f,E);i.length<f&&(u=!1);const n=i.filter(c=>!a(e).some(d=>d.id===c.id));n.length===0&&i.length>0&&i.length<f&&(u=!1),l(e,[...a(e),...n]),E+=f}catch(i){console.error("Failed to load feed",i)}finally{l(m,!1)}}}Pe(async()=>{await h(),$()});function $(){const i={root:a(p),threshold:.6};l(y,new IntersectionObserver(n=>{n.forEach(c=>{if(c.isIntersecting){const d=Number(c.target.getAttribute("data-index"));l(M,d),d>=a(e).length-2&&h()}})},i))}K(()=>(a(e),a(p),a(y)),()=>{a(e).length>0&&a(p)&&Ee().then(()=>{a(p).querySelectorAll(".feed-item-wrapper").forEach(n=>a(y).observe(n))})}),ce(),le();var j=Ye(),F=r(j);Fe(F,3,()=>a(e),i=>i.id,(i,n,c)=>{var d=Ke(),P=r(d);const C=Me(()=>a(c)===a(M));Je(P,{get persona(){return a(n)},get isActive(){return a(C)}}),o(d),U(()=>Le(d,"data-index",a(c))),g(i,d)});var w=v(F,2);{var z=i=>{var n=Ue(),c=r(n);Qe(c,{}),o(n),g(i,n)};k(w,i=>{a(m)&&i(z)})}var Q=v(w,2);{var A=i=>{var n=Xe();g(i,n)};k(Q,i=>{!a(m)&&a(e).length===0&&i(A)})}o(j),Ne(j,i=>l(p,i),()=>a(p)),g(V,j),ge()}export{mt as component};
