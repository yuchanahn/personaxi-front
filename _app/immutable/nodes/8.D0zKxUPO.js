import"../chunks/NZTpNUN0.js";import"../chunks/Vvm9udaT.js";import{c as Ga,o as Qt,a as Ka}from"../chunks/BB32ouRY.js";import{Z as Se,X as ea,_ as ta,aw as o,a2 as s,a3 as r,l as m,x as k,L as w,g as Wa,au as $t,av as za,w as e,aA as x,a0 as d,aS as Re}from"../chunks/DJxVeldX.js";import{s as v,e as U,r as qe}from"../chunks/C9woGF-z.js";import{i as P}from"../chunks/292SS5JT.js";import{k as Ya}from"../chunks/sCNk0_De.js";import{e as Rt,i as Za}from"../chunks/DHri6rd4.js";import{c as Tt,a as f,b as g,t as Ha}from"../chunks/fOQuHGXh.js";import{d as De,s as J,b as Fe,r as Ja,e as Qa}from"../chunks/CVCkp_ml.js";import{b as Ee}from"../chunks/BgFAjVCA.js";import{i as aa}from"../chunks/Degfot_7.js";import{s as ra,a as Lt}from"../chunks/ZTUH0_7J.js";import{g as Ht}from"../chunks/knpjl46v.js";import{p as er}from"../chunks/pmDB9vb6.js";import{s as tr,a as ar,f as rr,g as Et,u as St}from"../chunks/BGAOhipI.js";import{t as sr,a as ir}from"../chunks/CZB4GwcB.js";import{p as sa}from"../chunks/Zfh5ko2t.js";import{$ as ia}from"../chunks/Bit4kGOU.js";import{a as or}from"../chunks/BqlTOgs2.js";import{N as lr}from"../chunks/aRpSKKae.js";import{s as nr}from"../chunks/YXWdkqOL.js";import{a as vr}from"../chunks/BXQQiVcS.js";import{A as Jt}from"../chunks/CNDu6GJm.js";import{a as dr}from"../chunks/BRDq7uV6.js";var cr=g('<div class="overlay svelte-166qwhy"><div class="spinner svelte-166qwhy"></div></div>');function pr(ge,re){let se=sa(re,"isOpen",8,!1);var ie=Tt(),q=Se(ie);{var n=C=>{var $=cr();sr(3,$,()=>ir,()=>({duration:150})),f(C,$)};P(q,C=>{se()&&C(n)})}f(ge,ie)}var ur=g('<div class="modal-backdrop svelte-1qwexaa"><div class="confetti svelte-1qwexaa"></div> <div class="confetti svelte-1qwexaa"></div> <div class="confetti svelte-1qwexaa"></div> <div class="modal-content svelte-1qwexaa"><button class="close-button svelte-1qwexaa">&times;</button> <div class="icon-container svelte-1qwexaa"><!></div> <h2 class="svelte-1qwexaa"> </h2> <p class="reward-text svelte-1qwexaa"> <br/> <span class="highlight svelte-1qwexaa"> </span> </p> <p class="description svelte-1qwexaa"> </p> <button class="confirm-button svelte-1qwexaa"> </button></div></div>');function _r(ge,re){ea(re,!1);const[se,ie]=ra(),q=()=>Lt(ia,"$t",se);let n=sa(re,"isOpen",12,!1);const C=Ga();function $(){n(!1),C("close")}function i(N){n()&&N.key==="Escape"&&$()}Qt(()=>{window.addEventListener("keydown",i)}),Ka(()=>{window.removeEventListener("keydown",i)}),aa();var X=Tt(),D=Se(X);{var y=N=>{var F=ur(),T=o(s(F),6),oe=s(T),he=o(oe,2),I=s(he);lr(I,{size:64,color:"#ffc107"}),r(he);var V=o(he,2),Ie=s(V,!0);r(V);var be=o(V,2),W=s(be,!0),z=o(W,3),Le=s(z);r(z);var je=o(z,1,!0);r(be);var le=o(be,2),G=s(le,!0);r(le);var we=o(le,2),Ue=s(we,!0);r(we),r(T),r(F),m((Ce,O,Q,xe,Xe,ne)=>{v(Ie,Ce),v(W,O),v(Le,`100 ${Q??""}`),v(je,xe),v(G,Xe),v(Ue,ne)},[()=>q()("firstCreationRewardModal.title"),()=>q()("firstCreationRewardModal.message1"),()=>q()("paymentModal.creditsUnit"),()=>q()("firstCreationRewardModal.message2",{values:{amount:100}}),()=>q()("firstCreationRewardModal.message3"),()=>q()("firstCreationRewardModal.confirm")],k),U("click",oe,$),U("click",we,$),U("click",F,or($)),f(N,F)};P(D,N=>{n()&&N(y)})}f(ge,X),ta(),ie()}var fr=g("<span> </span>"),mr=g("<span> </span>"),gr=g("<span> </span>"),hr=g('<p class="error svelte-rdo32j"> </p>'),br=g('<span class="file-name svelte-rdo32j"> </span>'),jr=g('<div class="portrait-preview svelte-rdo32j"><!></div>'),wr=g('<div class="progress-bar-overlay svelte-rdo32j"><div class="progress-bar svelte-rdo32j"></div></div>'),xr=g("<span>복사 완료! ✅</span>"),yr=g("<span>태그 복사</span>"),Pr=g('<div class="asset-card svelte-rdo32j"><div class="asset-image-uploader svelte-rdo32j"><!> <!> <label class="file-input-label small svelte-rdo32j"><span> </span></label> <input type="file" accept="image/*, video/*" class="file-input-hidden svelte-rdo32j"/></div> <div class="asset-details svelte-rdo32j"><textarea class="asset-description-input svelte-rdo32j" rows="3"></textarea> <div class="asset-card-actions svelte-rdo32j"><button type="button" class="btn btn-secondary btn-copy svelte-rdo32j"><!></button> <button class="btn-remove asset-remove svelte-rdo32j">&times;</button></div></div></div>'),$r=g('<div class="form-group asset-section svelte-rdo32j"><h3 class="asset-title svelte-rdo32j"> </h3> <p class="description svelte-rdo32j"> </p> <div class="asset-card-list svelte-rdo32j"></div> <div class="asset-actions svelte-rdo32j"><label for="multiple-asset-upload" class="btn btn-secondary svelte-rdo32j"> </label> <input id="multiple-asset-upload" type="file" multiple accept="image/*, video/*" class="file-input-hidden svelte-rdo32j"/></div></div>'),Rr=g('<span class="file-name svelte-rdo32j"> </span>'),Er=g("<option> </option>"),Sr=g(`<audio controls class="svelte-rdo32j">Your browser does not support
                                                the audio element.</audio>`),Lr=g('<div class="voice-selector svelte-rdo32j"><select id="voice-select" class="svelte-rdo32j"><option disabled> </option><!></select> <!></div>'),Tr=g("<p> </p>"),Ar=g('<div class="form-group svelte-rdo32j"><label for="vrm" class="svelte-rdo32j"> </label> <div class="file-input-container svelte-rdo32j"><label for="vrm-file" class="file-input-label svelte-rdo32j"><span> </span></label> <input id="vrm-file" type="file" accept=".vrm" class="file-input-hidden svelte-rdo32j"/> <!> <!></div></div> <div class="form-group svelte-rdo32j"><label for="voice-select" class="svelte-rdo32j"> </label> <p class="description svelte-rdo32j"> </p> <!></div>',1),Mr=g('<div class="form-group svelte-rdo32j"><label for="prompt-template" class="svelte-rdo32j">프롬프트 템플릿 선택</label> <select id="prompt-template" class="svelte-rdo32j"><option>커스텀 템플릿</option><option>대화용 템플릿</option><option>시뮬레이션 템플릿</option></select></div>'),kr=g('<button type="button"> </button>'),qr=g('<div class="container svelte-rdo32j"><div class="header svelte-rdo32j"><h1> </h1> <button class="save-button svelte-rdo32j" type="submit"><!></button></div> <!> <div class="scrollable-content svelte-rdo32j"><div class="form-grid svelte-rdo32j"><div class="form-column svelte-rdo32j"><div class="form-section-card svelte-rdo32j"><h2 class="svelte-rdo32j"> </h2> <div class="form-group svelte-rdo32j"><label for="name" class="svelte-rdo32j"> </label> <input id="name" required class="svelte-rdo32j"/></div> <div class="form-group svelte-rdo32j"><label for="greeting" class="svelte-rdo32j"> </label> <p class="description svelte-rdo32j"> </p> <textarea id="greeting" rows="3" maxlength="200" class="svelte-rdo32j"></textarea> <div> </div></div> <div class="form-group svelte-rdo32j"><label for="personaType" class="svelte-rdo32j"> </label> <select id="personaType" required class="svelte-rdo32j"><option disabled> </option><option>3D</option><option>2D</option></select></div> <div class="form-group svelte-rdo32j"><label for="visibility" class="svelte-rdo32j"> </label> <select id="visibility" required class="svelte-rdo32j"><option> </option><option> </option></select></div></div> <div class="form-section-card svelte-rdo32j"><h2 class="svelte-rdo32j"> </h2> <div class="form-group svelte-rdo32j"><label for="portrait" class="svelte-rdo32j"> </label> <div class="file-input-container svelte-rdo32j"><label for="portrait-file" class="file-input-label svelte-rdo32j"><span> </span></label> <input id="portrait-file" type="file" accept="image/*, video/*" class="file-input-hidden svelte-rdo32j"/> <!></div> <!> <!></div> <!></div></div> <div class="form-column svelte-rdo32j"><div class="form-section-card svelte-rdo32j"><h2 class="svelte-rdo32j"> </h2> <div class="form-group svelte-rdo32j"><label for="first_scene" class="svelte-rdo32j"> </label> <p class="description svelte-rdo32j"> </p> <textarea id="first_scene" rows="5" maxlength="2500" class="svelte-rdo32j"></textarea> <div> </div></div> <div class="form-group svelte-rdo32j"><!> <label for="instruction-input" class="svelte-rdo32j"> </label> <p class="description svelte-rdo32j"> </p> <textarea id="instruction-input" rows="10" maxlength="3000" class="svelte-rdo32j"></textarea> <div> </div></div> <div class="form-group svelte-rdo32j"><label for="tags-container" class="svelte-rdo32j"> </label> <p class="description svelte-rdo32j"> </p> <div class="category-button-container svelte-rdo32j" id="tags-container"></div></div></div></div></div></div></div> <!> <!>',1);function os(ge,re){ea(re,!1);const[se,ie]=ra(),q=()=>Lt(er,"$page",se),n=()=>Lt(ia,"$t",se),C=w();let $=w(null),i=w({id:"",owner_id:[],name:"",personaType:"",instructions:[],promptExamples:[],tags:[],feedback:{view:0},voice_id:"",vrm_url:"",portrait_url:"",image_metadatas:[],visibility:"private",created_at:"",updated_at:"",creator_name:"",first_scene:"",greeting:"",likes_count:0,dislikes_count:0,chat_count:0}),X=w(""),D=w("custom"),y=w(""),N=w(null),F=w([]),T=w("");async function oe(a){try{const t=await ar(a);if(d(X,t.instructions[0]||""),t.instructions.length>1&&t.instructions[1]){const l=t.instructions[1];l==="conversation"?d(D,"conversation"):l==="simulation"?d(D,"simulation"):d(D,"custom")}else d(D,"custom");if(t.voice_id?d(T,t.voice_id):d(T,""),d(V,t.portrait_url),t.image_metadatas&&t.image_metadatas.length>0){const l=await rr(t.image_metadatas);t.image_metadatas=l}else t.image_metadatas=[];d(i,t)}catch(t){console.error("페르소나를 불러오는 데 실패했습니다:",t)}}function he(a){const t=a.target;t.files&&t.files.length>0&&(d($,t.files[0]),oa())}let I=w(null),V=w(null);function Ie(a){const t=a.target;t.files&&t.files.length>0&&(d(I,t.files[0]),d(V,URL.createObjectURL(e(I))),la())}Qt(async()=>{const t=new URLSearchParams(window.location.search).get("c");if(t&&oe(t),!await vr.isLoggedIn()){Ht("/login");return}try{const l=await fetch("/voices.json");if(l.ok){const c=await l.json();d(F,c.voices)}}catch(l){console.error("Failed to load voices.json",l)}});function be(a){e(i).tags.includes(a)?x(i,e(i).tags=e(i).tags.filter(t=>t!==a)):x(i,e(i).tags=[...e(i).tags,a])}let W=w(!1),z=w(!1),Le=w(0),je=w(!1),le=w(Wa(nr)?.data.hasReceivedFirstCreationReward??!1),G=w(new Map);async function we(a){const t=`<img ${a}>`;try{await navigator.clipboard.writeText(t),e(G).set(a,!0),d(G,e(G)),setTimeout(()=>{e(G).set(a,!1),d(G,e(G))},2e3)}catch(l){console.error("클립보드 복사 실패:",l)}}function Ue(a){x(i,e(i).image_metadatas=e(i).image_metadatas.filter((t,l)=>l!==a))}async function Ce(a,t){const l=a.target;if(l.files&&l.files.length>0){const c=l.files[0];await At(t,c)}}let O=w(new Map),Q=w(0),xe=0;async function Xe(a){const t=a.target;t.files&&Array.from(t.files).forEach(async l=>{const c={url:"",description:l.name};e(i).image_metadatas==null&&x(i,e(i).image_metadatas=[]),e(i).image_metadatas.push(c),await At(e(i).image_metadatas.length-1,l)})}const ne="https://uohepkqmwbstbmnkoqju.supabase.co/storage/v1/object/public/personaxi-assets/";async function At(a,t){for(let c=1;c<=3;c++)try{const p=await Et("asset");if(!p.ok)throw new Error(`Server error on getting URL: ${p.status}`);const{signedURL:_,fileName:j}=await p.json();c===1&&(x(i,e(i).image_metadatas[a].url=URL.createObjectURL(t)),x(i,e(i).image_metadatas=[...e(i).image_metadatas])),await St(_,t,A=>{e(O).set(a,A),d(O,e(O))}),e(O).delete(a),d(O,e(O)),x(i,e(i).image_metadatas[a].url=`${ne}${j}`),x(i,e(i).image_metadatas[a].type=void 0),console.log(`✅ ${t.name} uploaded successfully on attempt ${c}`);return}catch(p){console.warn(`Attempt ${c} for ${t.name} failed: ${p.message}`),c===3?(d(y,`File upload failed for ${t.name} after 3 attempts.`),console.error("Giving up on upload for",t.name)):await new Promise(_=>setTimeout(_,500))}}async function oa(){for(let t=1;t<=3;t++)try{const l=await Et("vrm");if(!l.ok)throw new Error(`Server error on getting URL: ${l.status}`);const{signedURL:c,fileName:p}=await l.json();d(Q,.01),await St(c,e($),_=>{d(Q,Math.round(_))}),x(i,e(i).vrm_url=`${ne}${p}`),d(Q,0),console.log(`✅ ${e($).name} uploaded successfully on attempt ${t}`);return}catch(l){console.warn(`Attempt ${t} for ${e($).name} failed: ${l.message}`),t===3?(d(y,`File upload failed for ${e($).name} after 3 attempts.`),console.error("Giving up on upload for",e($).name)):await new Promise(c=>setTimeout(c,500))}}async function la(){for(let t=1;t<=3;t++)try{const l=await Et("portrait");if(!l.ok)throw new Error(`Server error on getting URL: ${l.status}`);const{signedURL:c,fileName:p}=await l.json();xe=.01,await St(c,e(I),_=>{xe=Math.round(_)}),x(i,e(i).portrait_url=`${ne}${p}`),d(V,`${ne}${p}`),xe=0,console.log(`✅ ${e(I).name} uploaded successfully on attempt ${t}`);return}catch(l){console.warn(`Attempt ${t} for ${e(I).name} failed: ${l.message}`),t===3?(d(y,`File upload failed for ${e(I).name} after 3 attempts.`),console.error("Giving up on upload for",e(I).name)):await new Promise(c=>setTimeout(c,500))}}$t(()=>(e(F),e(T)),()=>{d(C,e(F).find(a=>a.voice_id===e(T)))}),$t(()=>e(T),()=>{e(T)?x(i,e(i).voice_id=e(T)):x(i,e(i).voice_id="")}),$t(()=>(q(),e(N)),()=>{const a=q().url.searchParams.get("c");a!==e(N)&&(d(N,a),a&&oe(a))}),za(),aa();var Mt=qr(),Oe=Se(Mt),Be=s(Oe),Ne=s(Be),na=s(Ne,!0);r(Ne);var Ve=o(Ne,2),va=s(Ve);{var da=a=>{var t=fr(),l=s(t);r(t),m((c,p)=>v(l,`${c??""} (${p??""}%)`),[()=>n()("editPage.saveButtonLoading"),()=>Math.round(e(Le))],k),f(a,t)},ca=(a,t)=>{{var l=p=>{var _=mr(),j=s(_,!0);r(_),m(A=>v(j,A),[()=>n()("editPage.saveButtonSuccess")],k),f(p,_)},c=p=>{var _=gr(),j=s(_,!0);r(_),m(A=>v(j,A),[()=>n()("editPage.saveButton")],k),f(p,_)};P(a,p=>{e(z)?p(l):p(c,!1)},t)}};P(va,a=>{e(W)?a(da):a(ca,!1)})}r(Ve),r(Be);var kt=o(Be,2);{var pa=a=>{var t=hr(),l=s(t,!0);r(t),m(()=>v(l,e(y))),f(a,t)};P(kt,a=>{e(y)&&a(pa)})}var qt=o(kt,2),Dt=s(qt),Ge=s(Dt),Ke=s(Ge),We=s(Ke),ua=s(We,!0);r(We);var ze=o(We,2),Ye=s(ze),_a=s(Ye,!0);r(Ye);var Ze=o(Ye,2);Ja(Ze),r(ze);var He=o(ze,2),Je=s(He),fa=s(Je,!0);r(Je);var Qe=o(Je,2),ma=s(Qe,!0);r(Qe);var Te=o(Qe,2);qe(Te);var et=o(Te,2);let Ft;var ga=s(et);r(et),r(He);var tt=o(He,2),at=s(tt),ha=s(at,!0);r(at);var rt=o(at,2);m(()=>{e(i),Re(()=>{n()})});var ye=s(rt);ye.value=ye.__value="";var ba=s(ye,!0);r(ye);var st=o(ye);st.value=st.__value="3D";var It=o(st);It.value=It.__value="2D",r(rt),r(tt);var Ut=o(tt,2),it=s(Ut),ja=s(it,!0);r(it);var ot=o(it,2);m(()=>{e(i),Re(()=>{n()})});var Pe=s(ot);Pe.value=Pe.__value="public";var wa=s(Pe,!0);r(Pe);var Ae=o(Pe);Ae.value=Ae.__value="private";var xa=s(Ae,!0);r(Ae),r(ot),r(Ut),r(Ke);var Ct=o(Ke,2),lt=s(Ct),ya=s(lt,!0);r(lt);var nt=o(lt,2),vt=s(nt),Pa=s(vt,!0);r(vt);var dt=o(vt,2),ct=s(dt),Xt=s(ct),$a=s(Xt,!0);r(Xt),r(ct);var Ot=o(ct,2),Ra=o(Ot,2);{var Ea=a=>{var t=br(),l=s(t,!0);r(t),m(()=>v(l,e(I).name)),f(a,t)};P(Ra,a=>{e(I)&&a(Ea)})}r(dt);var Bt=o(dt,2);{var Sa=a=>{var t=jr(),l=s(t);const c=k(()=>({url:e(V),description:""}));Jt(l,{get asset(){return e(c)}}),r(t),f(a,t)};P(Bt,a=>{e(V)&&a(Sa)})}var La=o(Bt,2);{var Ta=a=>{var t=$r(),l=s(t),c=s(l,!0);r(l);var p=o(l,2),_=s(p,!0);r(p);var j=o(p,2);Rt(j,5,()=>e(i).image_metadatas,Za,(te,B,S)=>{var Y=Pr(),K=s(Y),ce=s(K);{var ae=u=>{Jt(u,{get asset(){return e(B)}})};P(ce,u=>{e(B).url!==""&&u(ae)})}var pe=o(ce,2);{var $e=u=>{var L=wr(),me=s(L);r(L),m(Va=>Qa(me,`width: ${Va??""}%`),[()=>e(O).get(S)],k),f(u,L)};P(pe,u=>{e(O).has(S)&&u($e)})}var Z=o(pe,2);J(Z,"for",`asset-file-${S}`);var ue=s(Z),b=s(ue,!0);r(ue),r(Z);var h=o(Z,2);J(h,"id",`asset-file-${S}`),r(K);var E=o(K,2),R=s(E);qe(R);var _e=o(R,2),fe=s(_e),yt=s(fe);{var Pt=u=>{var L=xr();f(u,L)},M=u=>{var L=yr();f(u,L)};P(yt,u=>{e(G).get(S)?u(Pt):u(M,!1)})}r(fe);var H=o(fe,2);r(_e),r(E),r(Y),m((u,L)=>{v(b,u),J(R,"placeholder",L)},[()=>n()("editPage.imageSelect"),()=>n()("editPage.assetDescriptionPlaceholder")],k),U("change",h,u=>Ce(u,S)),Ee(R,()=>e(B).description,u=>(e(B).description=u,Re(()=>e(i)))),U("click",fe,()=>we(S)),U("click",H,()=>Ue(S)),f(te,Y)}),r(j);var A=o(j,2),ee=s(A),ve=s(ee,!0);r(ee);var de=o(ee,2);r(A),r(t),m((te,B,S)=>{v(c,te),v(_,B),v(ve,S)},[()=>n()("editPage.assetSectionTitle"),()=>n()("editPage.assetSectionDescription"),()=>n()("editPage.addAssetButton")],k),U("change",de,Xe),f(a,t)};P(La,a=>{e(i).personaType=="2D"&&a(Ta)})}r(nt);var Aa=o(nt,2);{var Ma=a=>{var t=Ar(),l=Se(t),c=s(l),p=s(c,!0);r(c);var _=o(c,2),j=s(_),A=s(j),ee=s(A,!0);r(A),r(j);var ve=o(j,2),de=o(ve,2);{var te=b=>{var h=Rr(),E=s(h,!0);r(h),m(()=>v(E,e($).name)),f(b,h)};P(de,b=>{e($)&&b(te)})}var B=o(de,2);{var S=b=>{var h=Ha();m(()=>v(h,`${e(Q)??""}%`)),f(b,h)};P(B,b=>{e(Q)>0&&b(S)})}r(_),r(l);var Y=o(l,2),K=s(Y),ce=s(K,!0);r(K);var ae=o(K,2),pe=s(ae,!0);r(ae);var $e=o(ae,2);{var Z=b=>{var h=Lr(),E=s(h);m(()=>{e(T),Re(()=>{n(),e(F)})});var R=s(E);R.value=R.__value="";var _e=s(R,!0);r(R);var fe=o(R);Rt(fe,1,()=>e(F),M=>M.voice_id,(M,H)=>{var u=Er(),L={},me=s(u,!0);r(u),m(()=>{L!==(L=e(H).voice_id)&&(u.value=(u.__value=e(H).voice_id)??""),v(me,e(H).name)}),f(M,u)}),r(E);var yt=o(E,2);{var Pt=M=>{var H=Tt(),u=Se(H);Ya(u,()=>e(C).voice_id,L=>{var me=Sr();m(()=>J(me,"src",e(C).preview_url)),f(L,me)}),f(M,H)};P(yt,M=>{e(C)&&M(Pt)})}r(h),m(M=>v(_e,M),[()=>n()("editPage.voiceSelectDefault")],k),De(E,()=>e(T),M=>d(T,M)),f(b,h)},ue=b=>{var h=Tr(),E=s(h,!0);r(h),m(R=>v(E,R),[()=>n()("editPage.voiceLoading")],k),f(b,h)};P($e,b=>{e(F).length>0?b(Z):b(ue,!1)})}r(Y),m((b,h,E,R)=>{v(p,b),v(ee,h),v(ce,E),v(pe,R)},[()=>n()("editPage.vrmFileLabel"),()=>n()("editPage.fileSelect"),()=>n()("editPage.voiceLabel"),()=>n()("editPage.voiceDescription")],k),U("change",ve,he),f(a,t)};P(Aa,a=>{e(i).personaType=="3D"&&a(Ma)})}r(Ct),r(Ge);var Nt=o(Ge,2),Vt=s(Nt),pt=s(Vt),ka=s(pt,!0);r(pt);var ut=o(pt,2),_t=s(ut),qa=s(_t,!0);r(_t);var ft=o(_t,2),Da=s(ft,!0);r(ft);var Me=o(ft,2);qe(Me);var mt=o(Me,2);let Gt;var Fa=s(mt);r(mt),r(ut);var gt=o(ut,2),Kt=s(gt);{var Ia=a=>{var t=Mr(),l=o(s(t),2);m(()=>{e(D),Re(()=>{})});var c=s(l);c.value=c.__value="custom";var p=o(c);p.value=p.__value="conversation";var _=o(p);_.value=_.__value="simulation",r(l),r(t),De(l,()=>e(D),j=>d(D,j)),f(a,t)};P(Kt,a=>{e(i).personaType!=="3D"&&a(Ia)})}var ht=o(Kt,2),Ua=s(ht,!0);r(ht);var bt=o(ht,2),Ca=s(bt,!0);r(bt);var ke=o(bt,2);qe(ke);var jt=o(ke,2);let Wt;var Xa=s(jt);r(jt),r(gt);var zt=o(gt,2),wt=s(zt),Oa=s(wt,!0);r(wt);var xt=o(wt,2),Ba=s(xt,!0);r(xt);var Yt=o(xt,2);Rt(Yt,5,()=>dr,a=>a.id,(a,t)=>{var l=kr();let c;var p=s(l,!0);r(l),m((_,j)=>{c=Fe(l,1,"category-button svelte-rdo32j",null,c,_),v(p,j)},[()=>({active:e(i).tags.includes(e(t).id.toString())}),()=>n()(e(t).nameKey)],k),U("click",l,()=>be(e(t).id.toString())),f(a,l)}),r(Yt),r(zt),r(Vt),r(Nt),r(Dt),r(qt),r(Oe);var Zt=o(Oe,2);pr(Zt,{get isOpen(){return e(W)}});var Na=o(Zt,2);_r(Na,{get isOpen(){return e(je)},set isOpen(a){d(je,a)},$$legacy:!0}),m((a,t,l,c,p,_,j,A,ee,ve,de,te,B,S,Y,K,ce,ae,pe,$e,Z,ue,b,h,E,R,_e)=>{v(na,a),v(ua,t),v(_a,l),J(Ze,"placeholder",c),v(fa,p),v(ma,_),J(Te,"placeholder",j),Ft=Fe(et,1,"char-counter svelte-rdo32j",null,Ft,A),v(ga,`${e(i).greeting.length??""} / 200`),v(ha,ee),v(ba,ve),v(ja,de),v(wa,te),v(xa,B),v(ya,S),v(Pa,Y),v($a,K),v(ka,ce),v(qa,ae),v(Da,pe),J(Me,"placeholder",$e),Gt=Fe(mt,1,"char-counter svelte-rdo32j",null,Gt,Z),v(Fa,`${e(i).first_scene.length??""} / 2500`),v(Ua,ue),v(Ca,b),J(ke,"placeholder",h),Wt=Fe(jt,1,"char-counter svelte-rdo32j",null,Wt,E),v(Xa,`${e(X).length??""} / 3000`),v(Oa,R),v(Ba,_e)},[()=>n()("editPage.title"),()=>n()("editPage.basicInfo"),()=>n()("editPage.nameLabel"),()=>n()("editPage.namePlaceholder"),()=>n()("editPage.greetingLabel",{default:n()("editPage.greetingLabelDefault")}),()=>n()("editPage.greetingDescription",{default:n()("editPage.greetingDescriptionDefault")}),()=>n()("editPage.greetingPlaceholder",{default:n()("editPage.greetingPlaceholderDefault")}),()=>({warning:e(i).greeting.length>160,error:e(i).greeting.length>=200}),()=>n()("editPage.typeLabel"),()=>n()("editPage.typeSelectDefault"),()=>n()("editPage.visibilityLabel"),()=>n()("editPage.public"),()=>n()("editPage.private"),()=>n()("editPage.mediaFiles"),()=>n()("editPage.profileImageLabel"),()=>n()("editPage.fileSelect"),()=>n()("editPage.aiSettings"),()=>n()("editPage.firstSceneLabel"),()=>n()("editPage.firstSceneDescription"),()=>n()("editPage.firstScenePlaceholder"),()=>({warning:e(i).first_scene.length>2400,error:e(i).first_scene.length>=2500}),()=>n()("editPage.instructionsLabel"),()=>n()("editPage.instructionsDescription"),()=>n()("editPage.instructionsPlaceholder"),()=>({warning:e(X).length>2500,error:e(X).length>=3e3}),()=>n()("editPage.tagsLabel"),()=>n()("editPage.tagsDescriptionCategory",{default:"카테고리를 선택하세요."})],k),U("click",Ve,async()=>{if(e(W)||e(z))return;d(y,"");let a=[e(X)];if(e(D)==="conversation"?a.push("conversation"):e(D)==="simulation"?a.push("simulation"):a.push("custom"),x(i,e(i).instructions=a),!e(i).name.trim()||!e(i).personaType.trim()||!e(i).greeting.trim()||!e(i).first_scene.trim()||e(i).instructions.length===0||e(i).tags.length===0){d(y,n()("editPage.validation.allFieldsRequired"));return}if(e(i).greeting.length>200||e(i).first_scene.length>2500){d(y,n()("editPage.validation.charLimitExceeded"));return}if(e(i).instructions[0].length>3e3){d(y,"지침은 3000자를 초과할 수 없습니다.");return}if(e(i).instructions.length===0||!e(i).instructions[0].trim()){d(y,n()("editPage.validation.allFieldsRequired"));return}if(e(i).promptExamples.some(t=>t.length>200)||e(i).promptExamples.length>10){d(y,n()("editPage.validation.promptExamplesLimitExceeded"));return}if(e(i).greeting.length>200||e(i).first_scene.length>2500){d(y,"소개 또는 첫 장면의 글자 수를 초과했습니다.");return}if(e(i).instructions.some(t=>t.length>3e3)||e(i).instructions.length>10){d(y,"지침의 글자 수를 초과했거나 10개를 초과했습니다.");return}if(e(i).promptExamples.some(t=>t.length>200)||e(i).promptExamples.length>10){d(y,n()("editPage.validation.promptExamplesLimitExceeded"));return}d(W,!0),d(Le,0);try{const t=await tr(e(i));t&&(d(z,!0),setTimeout(()=>{d(z,!1)},2e3),e(i).id?oe(t):(Ht(`/edit?c=${t}`,{replaceState:!0}),e(le)&&(d(je,!0),d(le,!1))))}catch(t){d(y,n()("editPage.errorSaveFailed",{values:{message:t.message}}))}finally{d(W,!1)}}),Ee(Ze,()=>e(i).name,a=>x(i,e(i).name=a)),Ee(Te,()=>e(i).greeting,a=>x(i,e(i).greeting=a)),De(rt,()=>e(i).personaType,a=>x(i,e(i).personaType=a)),De(ot,()=>e(i).visibility,a=>x(i,e(i).visibility=a)),U("change",Ot,Ie),Ee(Me,()=>e(i).first_scene,a=>x(i,e(i).first_scene=a)),Ee(ke,()=>e(X),a=>d(X,a)),f(ge,Mt),ta(),ie()}export{os as component};
