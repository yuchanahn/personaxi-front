import"../chunks/NZTpNUN0.js";import"../chunks/Vvm9udaT.js";import{o as pe}from"../chunks/BB32ouRY.js";import{X as me,_ as ue,a0 as w,L as q,w as t,a2 as r,a3 as a,l as y,x as T,aw as o,g as Tt,Z as it}from"../chunks/DJxVeldX.js";import{s as v,e as S}from"../chunks/C9woGF-z.js";import{i as B}from"../chunks/292SS5JT.js";import{e as lt,i as $t}from"../chunks/DHri6rd4.js";import{b as f,a as g,c as ge}from"../chunks/fOQuHGXh.js";import{s as E,r as _e,b as fe}from"../chunks/CVCkp_ml.js";import{b as he}from"../chunks/BgFAjVCA.js";import{s as ct}from"../chunks/BqlTOgs2.js";import{i as xe}from"../chunks/Degfot_7.js";import{s as be,a as It}from"../chunks/ZTUH0_7J.js";import{p as Pe}from"../chunks/pmDB9vb6.js";import{g as vt}from"../chunks/knpjl46v.js";import{l as ke}from"../chunks/BGAOhipI.js";import{I as L}from"../chunks/Cphc7EI3.js";import{a as we,L as ye}from"../chunks/CKOQZQXO.js";import{$ as Te}from"../chunks/Bit4kGOU.js";import{a as Ct}from"../chunks/BXQQiVcS.js";import{s as $e}from"../chunks/gt9WcTCj.js";import{c as Ie}from"../chunks/DjRwOXsZ.js";import{A as Ce}from"../chunks/CNDu6GJm.js";import{s as Le}from"../chunks/YXWdkqOL.js";var Ae=f('<p class="loading-text svelte-1t0nxdg"> </p>'),De=f("<button></button>"),Me=f('<div class="image-counter svelte-1t0nxdg"><!> <span> </span></div> <button class="nav-arrow left svelte-1t0nxdg"><!></button> <button class="nav-arrow right svelte-1t0nxdg"><!></button> <div class="indicator-dots svelte-1t0nxdg"></div>',1),Se=f("<!> <!>",1),Be=f('<button class="creator-info clickable svelte-1t0nxdg"><!> <span> </span> <!></button>'),Fe=f('<span class="tag svelte-1t0nxdg"> </span>'),Ne=f('<p class="scene-text svelte-1t0nxdg"> </p>'),Ee=f('<p class="scene-text svelte-1t0nxdg"> </p>'),je=f('<div class="first-scene-container svelte-1t0nxdg"><h3 class="scene-title svelte-1t0nxdg"><!> <span> </span></h3> <!></div>'),qe=f('<div class="comment-card svelte-1t0nxdg"><img class="comment-avatar svelte-1t0nxdg"/> <div class="comment-content svelte-1t0nxdg"><div class="comment-header svelte-1t0nxdg"><span class="comment-author svelte-1t0nxdg"> </span> <span class="comment-timestamp svelte-1t0nxdg"> </span></div> <p class="comment-text svelte-1t0nxdg"> </p></div></div>'),Ge=f('<p class="no-comments svelte-1t0nxdg"> </p>'),He=f('<div class="profile-container svelte-1t0nxdg"><div class="profile-main svelte-1t0nxdg"><div class="image-gallery-wrapper svelte-1t0nxdg"><!></div> <h1 class="character-name svelte-1t0nxdg"> </h1> <!> <p class="character-description svelte-1t0nxdg"> </p> <div class="tags-container svelte-1t0nxdg"><!></div> <!> <div class="stats-container svelte-1t0nxdg"><button class="stat-item svelte-1t0nxdg"><!> <span class="stat-label"> </span> <span class="stat-value"> </span></button> <div class="stat-item non-clickable svelte-1t0nxdg"><!> <span class="stat-label"> </span> <span class="stat-value"> </span></div></div> <button class="chat-start-button svelte-1t0nxdg"><span> </span> <!></button></div> <div class="comments-section svelte-1t0nxdg"><h2 class="comments-title svelte-1t0nxdg"> </h2> <div class="comments-list svelte-1t0nxdg"></div> <div class="comment-input-box svelte-1t0nxdg"><input type="text" class="svelte-1t0nxdg"/> <button class="btn-primary icon-button svelte-1t0nxdg"><!></button></div></div></div>'),Ke=f('<p class="error-text svelte-1t0nxdg"> </p>'),Re=f('<div class="scroll-container select-none svelte-1t0nxdg"><div class="profile-page-wrapper svelte-1t0nxdg"><!></div></div>');function ga(Lt,At){me(At,!1);const[dt,Dt]=be(),l=()=>It(Te,"$t",dt),Mt=()=>It(Pe,"$page",dt);let e=q(null),G=q([]),z=q(!0),H=q(""),A=q([]),D=q(0);async function St(s){const c=await Ct.get2(`/api/comments?personaId=${s}`);return c.ok?await c.json():(console.error("Failed to load comments"),[])}async function pt(){if(!(!t(H).trim()||!t(e)))try{const s=await Ct.post("/api/comments/create",{personaId:t(e).id,content:t(H)});if(!s.ok){const h=await s.json();throw new Error(h.error||"Failed to post comment")}const c=await s.json();w(G,[...t(G),c]),w(H,"")}catch(s){console.error("Error posting comment:",s),alert(l()("profilePage.commentPostFailed"))}}function Bt(s){s.stopPropagation(),t(e)?.owner_id&&vt(`/creator?c=${t(e).owner_id}`)}function Ft(s){const c=new Date,h=new Date(s),$=Math.round((c.getTime()-h.getTime())/1e3),u=Math.round($/60),x=Math.round(u/60),M=Math.round(x/24);return $<60?l()("time.now"):u<60?l()("time.minutesAgo",{values:{count:u}}):x<24?l()("time.hoursAgo",{values:{count:x}}):M<=7?l()("time.daysAgo",{values:{count:M}}):h.toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric"})}pe(async()=>{const s=Mt().url.searchParams.get("c");if(!s){w(z,!1);return}try{const[c,h,$]=await Promise.all([ke(s),St(s),we()]);if(w(e,c),$&&$.forEach(x=>{x===c.id&&(c.is_liked=!0)}),w(G,h),t(e)===null)throw"persona === null";let u=[];u.push({url:t(e).portrait_url,description:l()("profilePage.defaultProfile")}),t(e).image_metadatas&&t(e).image_metadatas.length>0&&(u=[...u,...t(e).image_metadatas]),w(A,u)}catch(c){console.error("Failed to load persona data:",c)}finally{w(z,!1)}});function Nt(){let s=Tt($e).llmType||"gemini-flash-lite";Ie.update(c=>{const h=c.find($=>$.id===t(e)?.id);return h&&(s=h.llmType||s),c}),t(e)?.personaType==="2D"||t(e)?.personaType==="2d"?vt(`/2d?c=${t(e).id}&llmType=${s}`):t(e)?.personaType==="3D"?vt(`/character?c=${t(e).id}&llmType=${s}`):alert(t(e)?.personaType)}async function Et(s){s.is_liked||await ye(s,()=>{t(e)&&t(e).id===s.id&&w(e,{...t(e),is_liked:!0,likes_count:t(e).likes_count+1})},c=>{alert(`좋아요 처리에 실패했습니다: ${c}`)})}function jt(){w(D,(t(D)-1+t(A).length)%t(A).length)}function qt(){w(D,(t(D)+1)%t(A).length)}function Gt(s){w(D,s)}function J(s){return t(e)?s.replaceAll("{{user}}",Tt(Le)?.data?.nickname||"User").replaceAll("{{char}}",t(e).name||"Character"):s}xe();var O=Re(),mt=r(O),Ht=r(mt);{var Kt=s=>{var c=Ae(),h=r(c,!0);a(c),y($=>v(h,$),[()=>l()("profilePage.loadingPersona")],T),g(s,c)},Rt=(s,c)=>{{var h=u=>{var x=He(),M=r(x),K=r(M),Ut=r(K);{var Xt=i=>{var n=Se(),d=it(n);Ce(d,{get asset(){return t(A)[t(D)]}});var p=o(d,2);{var b=m=>{var _=Me(),I=it(_),F=r(I);L(F,{icon:"ph:images-duotone"});var P=o(F,2),k=r(P);a(P),a(I);var C=o(I,2),N=r(C);L(N,{icon:"ph:caret-left-bold"}),a(C);var X=o(C,2),le=r(X);L(le,{icon:"ph:caret-right-bold"}),a(X);var wt=o(X,2);lt(wt,5,()=>t(A),$t,(ce,Ue,nt)=>{var Z=De();let yt;y((ve,de)=>{yt=fe(Z,1,"dot svelte-1t0nxdg",null,yt,ve),E(Z,"aria-label",de)},[()=>({active:nt===t(D)}),()=>l()("profilePage.imageMoveLabel",{values:{index:nt+1}})],T),S("click",Z,ct(()=>Gt(nt))),g(ce,Z)}),a(wt),y(()=>v(k,`${t(D)+1} / ${t(A).length??""}`)),S("click",C,ct(jt)),S("click",X,ct(qt)),g(m,_)};B(p,m=>{t(A).length>1&&m(b)})}g(i,n)};B(Ut,i=>{t(A).length>0&&i(Xt)})}a(K);var Q=o(K,2),Zt=r(Q,!0);a(Q);var ut=o(Q,2);{var zt=i=>{var n=Be(),d=r(n);L(d,{icon:"ph:user-circle-duotone"});var p=o(d,2),b=r(p,!0);a(p);var m=o(p,2);L(m,{icon:"ph:arrow-right-bold"}),a(n),y((_,I)=>{E(n,"aria-label",_),v(b,I)},[()=>l()("profilePage.goToCreatorProfile",{values:{creatorName:t(e).creator_name}}),()=>l()("profilePage.creatorInfo",{values:{creatorName:t(e).creator_name}})],T),S("click",n,Bt),g(i,n)};B(ut,i=>{t(e).creator_name&&i(zt)})}var V=o(ut,2),Jt=r(V,!0);a(V);var W=o(V,2),Ot=r(W);{var Qt=i=>{var n=ge(),d=it(n);lt(d,1,()=>t(e).tags,$t,(p,b)=>{var m=Fe(),_=r(m,!0);a(m),y(()=>v(_,t(b))),g(p,m)}),g(i,n)};B(Ot,i=>{t(e).tags&&t(e).tags.length>0&&i(Qt)})}a(W);var gt=o(W,2);{var Vt=i=>{var n=je(),d=r(n),p=r(d);L(p,{icon:"ph:scroll-duotone"});var b=o(p,2),m=r(b,!0);a(b),a(d);var _=o(d,2);{var I=P=>{var k=Ne(),C=r(k,!0);a(k),y(N=>v(C,N),[()=>l()("profilePage.translating")],T),g(P,k)},F=P=>{var k=Ee(),C=r(k,!0);a(k),y(N=>v(C,N),[()=>J(t(e).first_scene).length>500?J(t(e).first_scene).slice(0,500)+"...":J(t(e).first_scene)],T),g(P,k)};B(_,P=>{t(e).first_scene==="<tr>"?P(I):P(F,!1)})}a(n),y(P=>v(m,P),[()=>l()("profilePage.firstSceneTitle")],T),g(i,n)};B(gt,i=>{t(e).first_scene&&i(Vt)})}var Y=o(gt,2),j=r(Y),_t=r(j);const Wt=T(()=>t(e).is_liked?"ph:heart-fill":"ph:heart-bold"),Yt=T(()=>t(e).is_liked?"color: #ff79c6;":"");L(_t,{get icon(){return t(Wt)},get style(){return t(Yt)}});var tt=o(_t,2),te=r(tt,!0);a(tt);var ft=o(tt,2),ee=r(ft,!0);a(ft),a(j);var ht=o(j,2),xt=r(ht);L(xt,{icon:"ph:chat-circle-dots-bold"});var et=o(xt,2),ae=r(et,!0);a(et);var bt=o(et,2),re=r(bt,!0);a(bt),a(ht),a(Y);var at=o(Y,2),rt=r(at),se=r(rt,!0);a(rt);var oe=o(rt,2);L(oe,{icon:"ph:chat-circle-dots-duotone",width:"22",height:"22"}),a(at),a(M);var Pt=o(M,2),st=r(Pt),ne=r(st,!0);a(st);var ot=o(st,2);lt(ot,5,()=>t(G),i=>i.id,(i,n)=>{var d=qe(),p=r(d),b=o(p,2),m=r(b),_=r(m),I=r(_,!0);a(_);var F=o(_,2),P=r(F,!0);a(F),a(m);var k=o(m,2),C=r(k,!0);a(k),a(b),a(d),y(N=>{E(p,"src",t(n).author_avatar_url||"https://i.pravatar.cc/40?u="+t(n).author_id),E(p,"alt",t(n).author_name),v(I,t(n).author_name),v(P,N),v(C,t(n).content)},[()=>Ft(t(n).created_at)],T),g(i,d)},i=>{var n=Ge(),d=r(n,!0);a(n),y(p=>v(d,p),[()=>l()("profilePage.noComments")],T),g(i,n)}),a(ot);var kt=o(ot,2),R=r(kt);_e(R);var U=o(R,2),ie=r(U);L(ie,{icon:"ph:paper-plane-tilt-bold"}),a(U),a(kt),a(Pt),a(x),y((i,n,d,p,b,m,_,I)=>{v(Zt,t(e).name),v(Jt,i),j.disabled=t(e).is_liked,E(j,"aria-label",n),v(te,d),v(ee,t(e).likes_count),v(ae,p),v(re,t(e).chat_count),v(se,b),v(ne,m),E(R,"placeholder",_),E(U,"aria-label",I)},[()=>t(e).greeting==="<tr>"?l()("profilePage.translating"):t(e).greeting||l()("profilePage.defaultGreeting"),()=>l()("profilePage.likeButtonLabel"),()=>l()("profilePage.likeButtonLabel"),()=>l()("profilePage.interactionLabel"),()=>l()("profilePage.startChatButton"),()=>l()("profilePage.commentsTitle",{values:{count:t(G).length}}),()=>l()("profilePage.commentPlaceholder"),()=>l()("profilePage.registerButton")],T),S("click",j,()=>{t(e)&&Et(t(e))}),S("click",at,Nt),he(R,()=>t(H),i=>w(H,i)),S("keydown",R,i=>i.key==="Enter"&&pt()),S("click",U,pt),g(u,x)},$=u=>{var x=Ke(),M=r(x,!0);a(x),y(K=>v(M,K),[()=>l()("profilePage.personaNotFound")],T),g(u,x)};B(s,u=>{t(e)?u(h):u($,!1)},c)}};B(Ht,s=>{t(z)?s(Kt):s(Rt,!1)})}a(mt),a(O),g(Lt,O),ue(),Dt()}export{ga as component};
