import{d as y,b as x,f as Ct,e as oe}from"../chunks/kz80bbCR.js";import{i as ie}from"../chunks/2r1cYJse.js";import{o as se}from"../chunks/D0mpzbhj.js";import{w as ne,aq as re,ar as le,aj as k,z as ve,at as It,ap as b,al as c,O as rt,Q as t,W as C,V as f,am as r,an as Dt,as as lt,F as W,au as vt}from"../chunks/BUDlkbfV.js";import{s as O}from"../chunks/BbnaKca8.js";import{i as R}from"../chunks/28pso2Hb.js";import{e as B,i as q}from"../chunks/BOGOvxWJ.js";import{a as de}from"../chunks/BwRcvb6q.js";import{b as dt,s as L,a as ce,r as kt}from"../chunks/BJyhluUY.js";import{e as _,b as ue}from"../chunks/CiCNsvIE.js";import{b as ct}from"../chunks/njKOc8Q7.js";import{b as pe}from"../chunks/CGc6l0L7.js";import{I as ut}from"../chunks/DaDtKPX8.js";var fe=y('<div class="sidebar-item svelte-1rbv313" draggable="true"><!> <span> </span></div>'),be=Ct('<path class="connection-hitbox svelte-1rbv313" role="button" tabindex="-1"></path><path class="connection-line svelte-1rbv313"></path>',1),_e=Ct('<path class="connection-line active svelte-1rbv313"></path>'),me=y('<input class="header-input svelte-1rbv313" type="text"/>'),xe=y('<span class="node-title"> </span> <button class="edit-btn svelte-1rbv313"><!></button>',1),he=y('<textarea rows="2" class="svelte-1rbv313"></textarea>'),ge=y('<input type="text" class="svelte-1rbv313"/>'),ye=y('<div class="socket input svelte-1rbv313" role="button" tabindex="0"><div class="dot in-dot svelte-1rbv313"></div> <span> </span></div>'),we=y('<div class="socket output svelte-1rbv313" role="button" tabindex="-1"><span> </span> <div class="dot out-dot svelte-1rbv313"></div></div>'),$e=y('<div role="group"><div class="node-header svelte-1rbv313" role="button" tabindex="0"><!></div> <div class="node-body svelte-1rbv313"><!> <div class="node-io-row svelte-1rbv313"><div class="sockets mod-left svelte-1rbv313"></div> <div class="sockets mod-right svelte-1rbv313"></div></div></div> <div class="resize-handle svelte-1rbv313" role="button" tabindex="-1"><!></div></div>'),Ie=y('<span class="placeholder svelte-1rbv313"> </span>'),De=y("<span> </span>"),ke=y('<div class="result-box svelte-1rbv313"></div>'),Ce=y('<div class="placeholder-output svelte-1rbv313">...</div>'),Me=y('<div class="page-container svelte-1rbv313"><div class="sidebar svelte-1rbv313"><h2 class="sidebar-title svelte-1rbv313">Tools</h2> <div class="node-list"></div> <div class="divider svelte-1rbv313"></div> <div class="properties-panel"><h3>Usage</h3> <p class="hint svelte-1rbv313">1. Drag nodes to canvas.</p> <p class="hint svelte-1rbv313">2. Drag from Output to Input.</p></div></div> <div class="canvas-wrapper svelte-1rbv313" role="application"><div class="canvas-content svelte-1rbv313"><svg class="connections-layer svelte-1rbv313"><!><!></svg> <!></div> <div class="canvas-controls svelte-1rbv313"><button class="svelte-1rbv313">+</button> <span class="scale-text svelte-1rbv313"> </span> <button class="svelte-1rbv313">-</button></div></div> <div class="output-panel svelte-1rbv313"><div class="output-header svelte-1rbv313"><h2 class="svelte-1rbv313">Live Preview</h2></div> <div class="output-content svelte-1rbv313"><!></div></div></div>');function Ue(Mt,Pt){ne(Pt,!1);const H=C();let m=C([]),D=C([]),St=1,U=null,j=null,K=C(null),Q={x:0,y:0},T={w:0,h:0,x:0,y:0};function Nt(e,a){e.stopPropagation(),e.preventDefault(),f(K,a)}function Ot(e){e.focus()}function pt(){f(K,null)}function Xt(e){e.key==="Enter"&&pt()}let X=C(0),Y=C(0),v=C(1),J=!1,A={x:0,y:0},h=C(null),F=C({x:0,y:0}),M=C();se(()=>{z("text",100,100,"Start Greeting"),z("parameter",100,350,"User Name"),z("function",450,200,"Combine"),z("text",800,200,"Final Output")});function z(e,a,o,i){const n={id:`node_${St++}`,type:e,x:a,y:o,width:220,height:e==="text"?150:120,label:i||e.toUpperCase(),content:e==="text"?"Hello world":e==="parameter"?"{{user}}":"",inputs:[],outputs:[]};e==="text"?(n.inputs=[{id:"in_0",label:"Prepend"}],n.outputs=[{id:"out_0",label:"Out"}]):e==="parameter"?n.outputs=[{id:"out_0",label:"Value"}]:e==="function"?(n.inputs=[{id:"in_a",label:"A"},{id:"in_b",label:"B"}],n.outputs=[{id:"out_0",label:"Result"}]):e==="conditional"&&(n.inputs=[{id:"in_cond",label:"Condition"}],n.outputs=[{id:"out_true",label:"True"},{id:"out_false",label:"False"}]),f(m,[...t(m),n])}function Yt(e){if(!t(M))return;const a=t(M).getBoundingClientRect();if(f(F,{x:(e.clientX-a.left)/t(v)-t(X)/t(v),y:(e.clientY-a.top)/t(v)-t(Y)/t(v)}),U)f(m,t(m).map(o=>o.id===U?{...o,x:e.clientX/t(v)-Q.x,y:e.clientY/t(v)-Q.y}:o));else if(j){const o=(e.clientX-T.x)/t(v),i=(e.clientY-T.y)/t(v);f(m,t(m).map(s=>s.id===j?{...s,width:Math.max(150,T.w+o),height:Math.max(100,T.h+i)}:s))}else J&&(f(X,t(X)+(e.clientX-A.x)),f(Y,t(Y)+(e.clientY-A.y)),A={x:e.clientX,y:e.clientY})}function Rt(){U=null,j=null,J=!1,f(h,null)}function Bt(e,a){e.stopPropagation();const o=t(m).find(i=>i.id===a);o&&(U=a,Q={x:e.clientX/t(v)-o.x,y:e.clientY/t(v)-o.y})}function Tt(e,a){e.stopPropagation(),e.preventDefault(),j=a;const o=t(m).find(i=>i.id===a);o&&(T={w:o.width,h:o.height,x:e.clientX,y:e.clientY})}function Ft(e){(e.target===t(M)||e.target.closest(".connections-layer"))&&(J=!0,A={x:e.clientX,y:e.clientY})}function zt(e,a,o){e.stopPropagation(),e.preventDefault();const i=Z(a,o);i&&f(h,{nodeId:a,socketId:o,x:i.x,y:i.y})}function Et(e,a,o){e.stopPropagation(),t(h)&&t(h).nodeId!==a&&(t(D).some(s=>s.fromNodeId===t(h).nodeId&&s.fromSocketId===t(h).socketId&&s.toNodeId===a&&s.toSocketId===o)||(f(D,t(D).filter(s=>!(s.toNodeId===a&&s.toSocketId===o))),f(D,[...t(D),{id:`conn_${Date.now()}`,fromNodeId:t(h).nodeId,fromSocketId:t(h).socketId,toNodeId:a,toSocketId:o}]))),f(h,null)}function Lt(e,a){e.preventDefault(),e.stopPropagation(),f(D,t(D).filter(o=>o.id!==a))}function Z(e,a){const o=`socket_${e}_${a}`,i=document.getElementById(o);if(!i||!t(M))return null;const s=i.getBoundingClientRect(),n=t(M).getBoundingClientRect();return{x:(s.left+s.width/2-n.left)/t(v)-t(X)/t(v),y:(s.top+s.height/2-n.top)/t(v)-t(Y)/t(v)}}function ft(e,a){const o=Z(e.fromNodeId,e.fromSocketId),i=Z(e.toNodeId,e.toSocketId);if(!o||!i)return"M 0 0 L 0 0";const s=.5,n=Math.abs(i.x-o.x),p=Math.max(50,n*s);return`M ${o.x} ${o.y} C ${o.x+p} ${o.y} ${i.x-p} ${i.y} ${i.x} ${i.y}`}function Ut(e,a){const o=e.find(n=>n.label==="Final Output"||n.type==="text");if(!o)return"Error: No text node found.";const i=e.find(n=>n.label==="Final Output")||o,s=new Set;return bt(i.id,s,e,a)}function bt(e,a,o,i){if(a.has(e))return"[Cycle Detected]";a.add(e);const s=o.find(p=>p.id===e);if(!s)return"";const n={};if(s.inputs.forEach(p=>{const P=i.find(g=>g.toNodeId===e&&g.toSocketId===p.id);P?n[p.id]=bt(P.fromNodeId,new Set(a),o,i):n[p.id]=""}),s.type==="text")return Object.values(n).join("")+s.content;if(s.type==="parameter")return s.content;if(s.type==="function"){const p=n.in_a||"",P=n.in_b||"";return`${p} ${P}`.trim()}else if(s.type==="conditional")return"[One of paths]";return""}function jt(e){return e?e.split(/(\{\{.*?\}\})/g).map(o=>{const i=o.startsWith("{{")&&o.endsWith("}}");return{text:o,type:i?"placeholder":"text"}}):[]}function _t(e){let a=0;for(let i=0;i<e.length;i++)a=e.charCodeAt(i)+((a<<5)-a);return`hsl(${Math.abs(a%360)}, 75%, 65%)`}const At=[{type:"text",label:"Text Block",icon:"mdi:text"},{type:"parameter",label:"Parameter",icon:"mdi:code-braces"},{type:"conditional",label:"Condition",icon:"mdi:call-split"},{type:"function",label:"Combine",icon:"mdi:function"}];function Gt(e,a){e.dataTransfer?.setData("nodeType",a)}function Vt(e){e.preventDefault();const a=e.dataTransfer?.getData("nodeType");if(a&&t(M)){const o=t(M).getBoundingClientRect(),i=(e.clientX-o.left)/t(v)-t(X)/t(v),s=(e.clientY-o.top)/t(v)-t(Y)/t(v);z(a,i,s)}}re(()=>(t(m),t(D)),()=>{f(H,Ut(t(m),t(D)))}),le(),ie();var tt=Me();_("mousemove",It,Yt),_("mouseup",It,Rt);var et=c(tt),mt=b(c(et),2);B(mt,5,()=>At,q,(e,a)=>{var o=fe(),i=c(o);ut(i,{get icon(){return t(a).icon},width:"20"});var s=b(i,2),n=c(s,!0);r(s),r(o),k(()=>O(n,t(a).label)),_("dragstart",o,p=>Gt(p,t(a).type)),x(e,o)}),r(mt),Dt(4),r(et);var S=b(et,2),G=c(S),at=c(G),xt=c(at);B(xt,1,()=>t(D),e=>e.id,(e,a)=>{var o=be(),i=lt(o),s=b(i);k((n,p)=>{L(i,"d",n),L(s,"d",p)},[()=>ft(t(a),t(m)),()=>ft(t(a),t(m))],rt),_("contextmenu",i,n=>Lt(n,t(a).id)),x(e,o)});var Wt=b(xt);{var qt=e=>{var a=_e();k(()=>L(a,"d",`M ${t(h).x} ${t(h).y} C ${t(h).x+50} ${t(h).y} ${t(F).x-50} ${t(F).y} ${t(F).x} ${t(F).y}`)),x(e,a)};R(Wt,e=>{t(h)&&e(qt)})}r(at);var Ht=b(at,2);B(Ht,1,()=>t(m),e=>e.id,(e,a,o)=>{var i=$e(),s=c(i),n=c(s);{var p=u=>{var d=me();kt(d),W(()=>ct(d,()=>t(a).label,l=>(t(a).label=l,vt(()=>t(m))))),W(()=>_("keydown",d,Xt)),W(()=>_("blur",d,pt)),W(()=>_("mousedown",d,l=>l.stopPropagation())),de(d,l=>Ot?.(l)),x(u,d)},P=u=>{var d=xe(),l=lt(d),$=c(l,!0);r(l);var I=b(l,2),N=c(I);ut(N,{icon:"mdi:pencil",width:"14"}),r(I),k(()=>O($,t(a).label)),_("mousedown",I,ae=>Nt(ae,t(a).id)),x(u,d)};R(n,u=>{t(K)===t(a).id?u(p):u(P,!1)})}r(s);var g=b(s,2),w=c(g);{var E=u=>{var d=he();ue(d),ct(d,()=>t(a).content,l=>(t(a).content=l,vt(()=>t(m)))),x(u,d)},it=(u,d)=>{{var l=$=>{var I=ge();kt(I),ct(I,()=>t(a).content,N=>(t(a).content=N,vt(()=>t(m)))),x($,I)};R(u,$=>{t(a).type==="parameter"&&$(l)},d)}};R(w,u=>{t(a).type==="text"?u(E):u(it,!1)})}var V=b(w,2),st=c(V);B(st,5,()=>t(a).inputs,q,(u,d)=>{var l=ye(),$=b(c(l),2),I=c($,!0);r($),r(l),k(()=>{L(l,"id",`socket_${t(a).id}_${t(d).id}`),O(I,t(d).label)}),_("mouseup",l,N=>Et(N,t(a).id,t(d).id)),x(u,l)}),r(st);var $t=b(st,2);B($t,5,()=>t(a).outputs,q,(u,d)=>{var l=we(),$=c(l),I=c($,!0);r($),Dt(2),r(l),k(()=>{L(l,"id",`socket_${t(a).id}_${t(d).id}`),O(I,t(d).label)}),_("mousedown",l,N=>zt(N,t(a).id,t(d).id)),x(u,l)}),r($t),r(V),r(g);var nt=b(g,2),ee=c(nt);ut(ee,{icon:"mdi:resize-bottom-right",width:"16",color:"#666"}),r(nt),r(i),k(()=>{ce(i,1,`node ${t(a).type??""}`,"svelte-1rbv313"),dt(i,`left: ${t(a).x??""}px; top: ${t(a).y??""}px; width: ${t(a).width??""}px; height: ${t(a).height??""}px;`)}),_("mousedown",s,u=>Bt(u,t(a).id)),_("mousedown",nt,u=>Tt(u,t(a).id)),x(e,i)}),r(G);var ht=b(G,2),gt=c(ht),ot=b(gt,2),Kt=c(ot);r(ot);var Qt=b(ot,2);r(ht),r(S),pe(S,e=>f(M,e),()=>t(M));var yt=b(S,2),wt=b(c(yt),2),Jt=c(wt);{var Zt=e=>{var a=ke();B(a,5,()=>jt(t(H)),q,(o,i)=>{var s=oe(),n=lt(s);{var p=g=>{var w=Ie(),E=c(w,!0);r(w),k((it,V)=>{dt(w,`color: ${it??""}; background: ${V??""};`),O(E,t(i).text)},[()=>_t(t(i).text),()=>_t(t(i).text).replace(")",", 0.15)")],rt),x(g,w)},P=g=>{var w=De(),E=c(w,!0);r(w),k(()=>O(E,t(i).text)),x(g,w)};R(n,g=>{t(i).type==="placeholder"?g(p):g(P,!1)})}x(o,s)}),r(a),x(e,a)},te=e=>{var a=Ce();x(e,a)};R(Jt,e=>{t(H)?e(Zt):e(te,!1)})}r(wt),r(yt),r(tt),k(e=>{dt(G,`transform: translate(${t(X)??""}px, ${t(Y)??""}px) scale(${t(v)??""});`),O(Kt,`${e??""}%`)},[()=>Math.round(t(v)*100)],rt),_("click",gt,()=>f(v,Math.min(2,t(v)+.1))),_("click",Qt,()=>f(v,Math.max(.2,t(v)-.1))),_("mousedown",S,Ft),_("drop",S,Vt),_("dragover",S,e=>e.preventDefault()),x(Mt,tt),ve()}export{Ue as component};
