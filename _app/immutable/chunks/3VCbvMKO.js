import"./NZTpNUN0.js";import"./Vvm9udaT.js";import{o as N}from"./BB32ouRY.js";import{X as S,_ as k,a3 as m,a2 as f,aw as x,l as y,w as p,x as W,a0 as w,L as q}from"./DJxVeldX.js";import{s as h,e as $}from"./C9woGF-z.js";import{e as E,i as F}from"./DHri6rd4.js";import{b as _,a as g}from"./fOQuHGXh.js";import{i as C}from"./Degfot_7.js";import{p as B}from"./Zfh5ko2t.js";import{s as I,a as O}from"./ZTUH0_7J.js";import{s as J,r as L}from"./CVCkp_ml.js";import{b as P}from"./BgFAjVCA.js";import{$ as j}from"./Bit4kGOU.js";var D=_('<div class="chat-message svelte-2nfipp"><strong class="username svelte-2nfipp"> </strong> </div>'),H=_('<div class="broadcast-chat-window svelte-2nfipp"></div>');function st(r,n){S(n,!1);const[u,v]=I(),d=()=>O(c(),"$messages",u);let c=B(n,"messages",8);N(()=>{const e=document.querySelector(".broadcast-chat-window"),s=new MutationObserver(()=>{e?.scrollTo({top:e.scrollHeight,behavior:"smooth"})});return e&&s.observe(e,{childList:!0,subtree:!0}),()=>s.disconnect()}),C();var t=H();E(t,5,d,F,(e,s)=>{var a=D(),i=f(a),b=f(i,!0);m(i);var l=x(i);m(a),y(()=>{h(b,p(s).user),h(l,`: ${p(s).msg??""}`)}),g(e,a)}),m(t),g(r,t),k(),v()}var T=_('<div class="broadcast-chat-input svelte-1c91406"><input class="svelte-1c91406"/> <button class="svelte-1c91406"> </button></div>');function at(r,n){S(n,!1);const[u,v]=I(),d=()=>O(j,"$t",u);let c=B(n,"onSend",8),t=q("");function e(){p(t).trim()&&(c()(p(t).trim()),w(t,""))}C();var s=T(),a=f(s);L(a);var i=x(a,2),b=f(i,!0);m(i),m(s),y((l,M)=>{J(a,"placeholder",l),h(b,M)},[()=>d()("broadcastChatInput.placeholder"),()=>d()("broadcastChatInput.sendButton")],W),P(a,()=>p(t),l=>w(t,l)),$("keydown",a,l=>l.key==="Enter"&&e()),$("click",i,e),g(r,s),k(),v()}let o=null;function ot(r,n,u,v){return o=new WebSocket(`ws://localhost:8080/ws/broadcast?personaId=${r}`),o.onopen=()=>{console.log("broadcast.connected")},o.onclose=()=>{console.warn("broadcast.disconnected")},o.onmessage=d=>{try{const c=JSON.parse(d.data);n(c)}catch(c){console.warn("broadcast.jsonParseFailed"),console.error(c)}},o}function rt(r){o&&o.readyState===WebSocket.OPEN?o.send(JSON.stringify({type:"chat",msg:r})):console.warn("broadcast.sendFailed")}export{st as B,at as a,ot as c,rt as s};
