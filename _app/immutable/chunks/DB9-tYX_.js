import{d as _,b as h}from"./kz80bbCR.js";import{i as S}from"./2r1cYJse.js";import{o as M}from"./D0mpzbhj.js";import{w as k,z as x,am as m,al as f,ap as y,aj as C,Q as p,O as N,V as w,W as j}from"./BUDlkbfV.js";import{s as g}from"./BbnaKca8.js";import{e as q,i as E}from"./BOGOvxWJ.js";import{p as B}from"./Bf5_DoVm.js";import{s as O,a as I}from"./D32zTIdM.js";import{s as F,r as J}from"./BJyhluUY.js";import{e as $}from"./CiCNsvIE.js";import{b as P}from"./njKOc8Q7.js";import{$ as z}from"./C36u96xB.js";var D=_('<div class="chat-message svelte-2nfipp"><strong class="username svelte-2nfipp"> </strong> </div>'),H=_('<div class="broadcast-chat-window svelte-2nfipp"></div>');function et(r,n){k(n,!1);const[u,v]=O(),d=()=>I(c(),"$messages",u);let c=B(n,"messages",8);M(()=>{const e=document.querySelector(".broadcast-chat-window"),s=new MutationObserver(()=>{e?.scrollTo({top:e.scrollHeight,behavior:"smooth"})});return e&&s.observe(e,{childList:!0,subtree:!0}),()=>s.disconnect()}),S();var t=H();q(t,5,d,E,(e,s)=>{var a=D(),i=f(a),b=f(i,!0);m(i);var l=y(i);m(a),C(()=>{g(b,p(s).user),g(l,`: ${p(s).msg??""}`)}),h(e,a)}),m(t),h(r,t),x(),v()}var L=_('<div class="broadcast-chat-input svelte-1c91406"><input class="svelte-1c91406"/> <button class="svelte-1c91406"> </button></div>');function st(r,n){k(n,!1);const[u,v]=O(),d=()=>I(z,"$t",u);let c=B(n,"onSend",8),t=j("");function e(){p(t).trim()&&(c()(p(t).trim()),w(t,""))}S();var s=L(),a=f(s);J(a);var i=y(a,2),b=f(i,!0);m(i),m(s),C((l,W)=>{F(a,"placeholder",l),g(b,W)},[()=>d()("broadcastChatInput.placeholder"),()=>d()("broadcastChatInput.sendButton")],N),P(a,()=>p(t),l=>w(t,l)),$("keydown",a,l=>l.key==="Enter"&&e()),$("click",i,e),h(r,s),x(),v()}let o=null;function at(r,n,u,v){return o=new WebSocket(`ws://localhost:8080/ws/broadcast?personaId=${r}`),o.onopen=()=>{console.log("broadcast.connected")},o.onclose=()=>{console.warn("broadcast.disconnected")},o.onmessage=d=>{try{const c=JSON.parse(d.data);n(c)}catch(c){console.warn("broadcast.jsonParseFailed"),console.error(c)}},o}function ot(r){o&&o.readyState===WebSocket.OPEN?o.send(JSON.stringify({type:"chat",msg:r})):console.warn("broadcast.sendFailed")}export{et as B,st as a,at as c,ot as s};
