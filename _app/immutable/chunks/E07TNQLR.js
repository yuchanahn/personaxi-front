import{s as h}from"./C-VEydUt.js";import"./-4D0oWvs.js";const s="https://api.personaxi.com";async function i(o,e={}){e.credentials="include";const t=new Headers(e.headers),{data:{session:r}}=await h.auth.getSession(),n=r?.access_token,w=e.requireAuth!==!1;if(n)t.set("Authorization",`Bearer ${n}`);else if(w)throw window.location.href="/login",new Error("No session");e.body&&!t.has("Content-Type")&&t.set("Content-Type","application/json"),e.headers=t;let a=await fetch(o,e);if(a.status===401&&w)throw window.location.href="/login",new Error("Unauthorized");if(a.status===503)throw window.location.pathname!=="/maintenance"&&(window.location.href="/maintenance"),new Error("Service Unavailable");if(a.status===403)throw window.location.pathname!=="/suspended"&&(window.location.href="/suspended"),new Error("Forbidden");return a}const l={get:(o,e)=>i(s+o,{...e,method:"GET"}),get2:(o,e)=>i(s+o,{...e,method:"GET",requireAuth:!1}),post:(o,e,t)=>i(s+o,{...t,method:"POST",body:JSON.stringify(e)}),post2:(o,e,t)=>i(s+o,{...t,method:"POST",body:JSON.stringify(e),requireAuth:!1}),delete(o,e){return i(s+o,{...e,method:"DELETE"})},put:(o,e,t)=>i(s+o,{...t,method:"PUT",body:JSON.stringify(e)}),ws:async(o,e)=>{const{data:{session:t}}=await h.auth.getSession();if(!t)throw new Error("No active session. Please login first.");const r=t.access_token;let n;const w=window.location.protocol==="https:"?"wss:":"ws:",a=o.includes("?")?"&":"?",d=`${o}${a}token=${encodeURIComponent(r)}`;{const u=new URL(s);n=`${w}//${u.host}${d}`}const c=new WebSocket(n);return e.onOpen&&(c.onopen=e.onOpen),e.onMessage&&(c.onmessage=e.onMessage),e.onClose&&(c.onclose=e.onClose),e.onError&&(c.onerror=e.onError),c},isLoggedIn:async()=>{const{data:{user:o}}=await h.auth.getUser();return!!o},convertPoints:async o=>{const{data:{session:e}}=await h.auth.getSession(),t=e?.access_token,r=await fetch(`${s}/api/user/convert-points`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({amount:o})});if(!r.ok){const n=await r.json().catch(()=>({}));throw new Error(n.error||n.message||"Failed to convert points")}return r.json()}};export{l as a};
